<!-- Content Header (Page header) -->
    <div class="row" style="margin-top: 20px">
        <div class="col-md-6">
            <div class="box box-solid box-default">
                <div class="box-header">
                    <h1 style="margin:0">
                        Entities
                        <small>many-to-may</small>
                    </h1>
                </div>

                <!-- Main content -->
                <div class="box-body">
                    <p class="lead">
                        CarbonPHP uses a many-to-many relational database model.</p>
                    <p>We implement this by
                        having a <a href="https://carbonphp.com/Entities#Transactions" class="text-purple">master table</a> that contains only primary keys. This proves helpful when
                        managing fully dynamic websites where a column may depend on multiple other tables.
                        For example, if we wanted to built a comment box that allowed any number of sub comments,
                        images to be posted on comments, and reactions (such as liking) to comments than we would
                        need a way to relate all of these items to the original post. A relational database helps
                        us achieve this by means of Cascading, Deleting, Setting to Null, Setting to Default, and
                        No Action directives. These methods describe what should happen to a column entry if it's
                        parent should be deleted. To continue on the example above, if the article where all of these
                        posts are located is deleted than every post, image, and reaction needs to be deleted. This
                        is the DELETE directive built into InnoDB.</p>

                </div>
            </div>
            <div class="box box-solid box-info" id="Transactions">
                <div class="box-header">
                    <h1 style="margin: 0"> Transactions</h1>
                </div>
                <div class="box-body">
                    <p class="lead">The master table</p>
                    <img class="img-responsive" src="https://carbonphp.com/Application/view/mustache/Img/documentation/carbon-db.png">
                    <br>

                    <p>The table structure, carbon, described above is how our application will manage all primary keys.
                        The primary key must be inserted and committed before other columns may reference it. This
                        is problematic should your insertion query fail. We solve this timing problem by using a
                        transaction system modeled off PHP's PDO class.</p>

                    <pre><code>Carbon\Entities::beginTransaction();</code></pre>

                    <p>The method above will insert a new key to the Carbon table then return its value as a string.
                        You should use this method for all primary key transactions and use its return for your foreign
                        key column. After your query has successfully run you must finish by committing the transaction
                        to memory.</p>

                    <pre><code>Carbon\Entities::commit();</code></pre>

                    <p>We strictly follow the <a href="https://carbonphp.com/FileStructure">MVC patten</a> in C6. This means the
                        Controller and Model are wrapped in a Try // Catch block. We attach a Finally Clause meaning
                        no matter what state we are in the following code will be run.</p>

                    <pre><code>Carbon\Entities:verify();</code></pre>

                    <p>If the verify function is reached and a transaction has not been committed, or threw an error,
                        All keys created by <code>beginTransaction()</code> will be removed. It should be noted that
                        Begin transaction can be run multiple times; however, <code>commit()</code> will finalize all
                        keys.</p>

                    <p></p>
                    <!-- ============================================================= -->

                </div><!-- /.content -->
            </div>
        </div>
        <div class="col-md-6">
            <div class="box box-solid box-success">
                <div class="box-header">
                    <h1 style="margin: 0">Predefined Tables</h1>
                </div>
                <div class="box-body">
                    <div class="callout callout-warning">If you plan to using an existing database be sure to name it
                        correctly before deployment. CarbonPHP automatically builds a new database if it does not already exist.
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <p>The <u>CarbonPHP library</u> will automatically set up the following tables:</p>
                            <ul>
                                <li>carbon</li>
                                <li>carbon_reports</li>
                                <li>carbon_sessions</li>
                                <li>carbon_tags</li>
                                <li>carbon_tag</li>
                                <li>sessions</li>
                            </ul>
                            <p style="margin-top:5px">The <u>C6 framework</u> uses the <a href="https://carbonphp.com/Options">['DATABASE']['DB_BUILD'] option</a> to construct its own set
                                of tables after CarbonPHP's build is complete. You should add all new tables to this build file.</p>

                            <ul>
                                <li>carbon_users</li>
                                <li>carbon_locations</li>
                                <li>carbon_comments</li>
                                <li>carbon_photos</li>
                                <li>user_followers</li>
                                <li>user_messages</li>
                                <li>user_tasks</li>
                            </ul>

                        </div>
                        <img class="img-responsive col-md-6" src="https://carbonphp.com/Application/view/mustache/Img/documentation/carbon-tables.png">
                    </div>
                    <div class="col-md-12">
                        <p class="lead">Each time you create a new table you should immediately think to do two thing:</p>
                        <ol>
                            <li>Add a class with the exact same name as your table suffix. If your table has a foreign key
                                dependency on another table exclusively the table should be
                                prefixed with the parent tables name.
                                <ul>
                                    <li>This class should be placed in the "Application/Table/" folder.</li>
                                    <li>It must implement the "Carbon\Interfaces\iTable" contract</li>
                                    <li>It should extend the "Carbon\Entities" class</li>
                                </ul>
                            </li>
                            <li>Add the table structure to your auto database builder.
                                <ul>
                                    <li>This file should be modeled off our buildDatabase file</li>
                                    <li>You can define the location of your builder in the options</li>
                                </ul>
                            </li>
                        </ol>
                        <p>It's important to add the table to your build file, this ensures portability among
                            team members and the application itself must it ever need to change servers.
                        </p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="box box-solid box-default">
        <div class="box-header">
            <h1 style="margin:0">The Entities Class</h1>
        </div>
        <div class="box-body">
            <ol class="breadcrumb">
                <li><i class="fa fa-code"></i> APP_ROOT</li>
                <li>Data</li>
                <li>Vendors</li>
                <li>richardtmiles</li>
                <li>Structure</li>
                <li>Entities.php</li>
            </ol>
            <p class="lead">This is designed to streamline sql queries. Using the <a href="http://php.net/manual/en/book.pdo.php">PHP Data Object (PDO)
                is our biggest defence against XSS attacks</a>.</p>
            <pre><code><span style="overflow-x: scroll"><span style="color: #0000BB"><br></span><span style="color: #FF8000">/**<br>&nbsp;*&nbsp;Created&nbsp;by&nbsp;IntelliJ&nbsp;IDEA.<br>&nbsp;*&nbsp;User:&nbsp;Miles<br>&nbsp;*&nbsp;Date:&nbsp;7/28/17<br>&nbsp;*&nbsp;Time:&nbsp;5:48&nbsp;AM<br>&nbsp;*/<br><br></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">Carbon</span><span style="color: #007700">;<br><br>use&nbsp;</span><span style="color: #0000BB">Carbon</span><span style="color: #007700">\</span><span style="color: #0000BB">Helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Bcrypt</span><span style="color: #007700">;<br>use&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">;<br>use&nbsp;</span><span style="color: #0000BB">stdClass</span><span style="color: #007700">;<br>use&nbsp;</span><span style="color: #0000BB">Carbon</span><span style="color: #007700">\</span><span style="color: #0000BB">Helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Globals</span><span style="color: #007700">;<br>use&nbsp;</span><span style="color: #0000BB">Carbon</span><span style="color: #007700">\</span><span style="color: #0000BB">Interfaces</span><span style="color: #007700">\</span><span style="color: #0000BB">iTable</span><span style="color: #007700">;<br>use&nbsp;</span><span style="color: #0000BB">Carbon</span><span style="color: #007700">\</span><span style="color: #0000BB">Throwables</span><span style="color: #007700">\</span><span style="color: #0000BB">PublicAlert</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/**<br>&nbsp;*&nbsp;Class&nbsp;Entities<br>&nbsp;*&nbsp;@link&nbsp;https://en.wikipedia.org/wiki/Entity–component–system<br>&nbsp;*&nbsp;@package&nbsp;Carbon<br>&nbsp;*<br>&nbsp;*&nbsp;Popular&nbsp;in&nbsp;game&nbsp;development,&nbsp;web&nbsp;apps&nbsp;are&nbsp;perfect<br>&nbsp;*&nbsp;candidates&nbsp;for&nbsp;Entity&nbsp;Systems.<br>&nbsp;*&nbsp;Databases&nbsp;become&nbsp;complicated&nbsp;when&nbsp;you&nbsp;need<br>&nbsp;*&nbsp;a&nbsp;hierarchical&nbsp;system&nbsp;of&nbsp;inheritance.<br>&nbsp;*&nbsp;A&nbsp;singular&nbsp;tuple&nbsp;table&nbsp;containing&nbsp;only&nbsp;primary&nbsp;keys&nbsp;solves<br>&nbsp;*&nbsp;this&nbsp;issue.&nbsp;If&nbsp;a&nbsp;table&nbsp;needs&nbsp;or&nbsp;may&nbsp;need&nbsp;a&nbsp;primary&nbsp;key,&nbsp;you<br>&nbsp;*&nbsp;must&nbsp;use&nbsp;the&nbsp;Entities.beginTransaction()&nbsp;&amp;<br>&nbsp;*&nbsp;&nbsp;Entities.commit()&nbsp;methods&nbsp;to&nbsp;generate&nbsp;them.<br>&nbsp;*/<br></span><span style="color: #007700">abstract&nbsp;class&nbsp;</span><span style="color: #0000BB">Entities<br></span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;PDO&nbsp;-&nbsp;Represents&nbsp;a&nbsp;connection&nbsp;between&nbsp;PHP&nbsp;and&nbsp;a&nbsp;database&nbsp;server.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;http://php.net/manual/en/class.pdo.php<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;bool&nbsp;-&nbsp;Represents&nbsp;a&nbsp;post,&nbsp;aka&nbsp;new&nbsp;row&nbsp;inception&nbsp;with&nbsp;foreign&nbsp;keys,&nbsp;in&nbsp;progress.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;static&nbsp;</span><span style="color: #0000BB">$inTransaction&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@var&nbsp;array&nbsp;-&nbsp;new&nbsp;key&nbsp;inserted&nbsp;but&nbsp;not&nbsp;verified&nbsp;currently<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;static&nbsp;</span><span style="color: #0000BB">$entityTransactionKeys</span><span style="color: #007700">;<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Entities&nbsp;constructor.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array|null&nbsp;$array<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Define&nbsp;our&nbsp;database&nbsp;and&nbsp;possibly&nbsp;create&nbsp;a&nbsp;new&nbsp;row&nbsp;in&nbsp;the&nbsp;database<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(array&nbsp;&amp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">iTable&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">::</span><span style="color: #0000BB">Post</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Check&nbsp;our&nbsp;database&nbsp;to&nbsp;verify&nbsp;that&nbsp;a&nbsp;transaction<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;didn't&nbsp;fail&nbsp;after&nbsp;adding&nbsp;an&nbsp;a&nbsp;new&nbsp;primary&nbsp;key.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;If&nbsp;verify&nbsp;is&nbsp;run&nbsp;before&nbsp;commit,&nbsp;the&nbsp;transaction<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;and&nbsp;newly&nbsp;created&nbsp;primary&nbsp;keys&nbsp;will&nbsp;be&nbsp;removed.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Foreign&nbsp;keys&nbsp;are&nbsp;created&nbsp;in&nbsp;the&nbsp;beginTransaction()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;method&nbsp;found&nbsp;in&nbsp;this&nbsp;class.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;https://www.w3schools.com/sql/sql_primarykey.asp<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string|null&nbsp;$errorMessage<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;bool<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">verify</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$errorMessage&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">):&nbsp;</span><span style="color: #0000BB">bool<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!static::</span><span style="color: #0000BB">$inTransaction</span><span style="color: #007700">)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;We're&nbsp;verifying&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;un&nbsp;finished&nbsp;transaction<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$entityTransactionKeys</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$entityTransactionKeys&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static::</span><span style="color: #0000BB">remove_entity</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">rollBack</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(\</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PublicAlert</span><span style="color: #007700">::</span><span style="color: #0000BB">danger</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$errorMessage</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">PublicAlert</span><span style="color: #007700">::</span><span style="color: #0000BB">danger</span><span style="color: #007700">(</span><span style="color: #0000BB">$errorMessage</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Commit&nbsp;the&nbsp;current&nbsp;transaction&nbsp;to&nbsp;the&nbsp;database.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;http://php.net/manual/en/pdo.rollback.php<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;callable|null&nbsp;$lambda<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;bool<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">commit</span><span style="color: #007700">(callable&nbsp;</span><span style="color: #0000BB">$lambda&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">):&nbsp;</span><span style="color: #0000BB">bool<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">commit</span><span style="color: #007700">())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;static::</span><span style="color: #0000BB">verify</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$inTransaction&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$entityTransactionKeys&nbsp;</span><span style="color: #007700">=&nbsp;[];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(\</span><span style="color: #0000BB">is_callable</span><span style="color: #007700">(</span><span style="color: #0000BB">$lambda</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$lambda</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Based&nbsp;off&nbsp;the&nbsp;pdo.beginTransaction()&nbsp;method<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;http://php.net/manual/en/pdo.begintransaction.php<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Primary&nbsp;keys&nbsp;that&nbsp;are&nbsp;also&nbsp;foreign&nbsp;keys&nbsp;require&nbsp;the&nbsp;references<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;be&nbsp;present&nbsp;before&nbsp;they&nbsp;may&nbsp;be&nbsp;inserted.&nbsp;PDO&nbsp;has&nbsp;built&nbsp;transactions<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;but&nbsp;if&nbsp;you&nbsp;try&nbsp;creating&nbsp;a&nbsp;new&nbsp;row&nbsp;which&nbsp;has&nbsp;a&nbsp;reference&nbsp;to&nbsp;a&nbsp;primary<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;key&nbsp;created&nbsp;in&nbsp;the&nbsp;transaction,&nbsp;it&nbsp;will&nbsp;fail.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;&lt;b&gt;must&nbsp;be&nbsp;static&lt;/b&gt;&nbsp;so&nbsp;multiple&nbsp;table&nbsp;files&nbsp;can&nbsp;insert&nbsp;on&nbsp;the&nbsp;same<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;transaction&nbsp;without&nbsp;running&nbsp;beginTransaction&nbsp;again<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$tag_id&nbsp;-&nbsp;passed&nbsp;to&nbsp;new_entity<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;null&nbsp;$dependant&nbsp;-&nbsp;passed&nbsp;to&nbsp;new_entity<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;bool|\PDOStatement|string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">beginTransaction</span><span style="color: #007700">(</span><span style="color: #0000BB">$tag_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dependant&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$inTransaction&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">new_entity</span><span style="color: #007700">(</span><span style="color: #0000BB">$tag_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dependant</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">beginTransaction</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$tag_id<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;This&nbsp;will&nbsp;be&nbsp;inserted&nbsp;in&nbsp;out&nbsp;tags&nbsp;table,&nbsp;it&nbsp;is&nbsp;just&nbsp;a&nbsp;reference<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;I&nbsp;define&nbsp;constants&nbsp;named&nbsp;after&nbsp;the&nbsp;tables&nbsp;in&nbsp;the&nbsp;configuration&nbsp;file<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;which&nbsp;I&nbsp;use&nbsp;for&nbsp;this&nbsp;field.&nbsp;(&nbsp;USERS,&nbsp;MESSAGES,&nbsp;ect...)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$dependant<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;bool|\PDOStatement|string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">new_entity</span><span style="color: #007700">(</span><span style="color: #0000BB">$tag_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dependant</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(\</span><span style="color: #0000BB">defined</span><span style="color: #007700">(</span><span style="color: #0000BB">$tag_id</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tag_id&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">constant</span><span style="color: #007700">(</span><span style="color: #0000BB">$tag_id</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'INSERT&nbsp;INTO&nbsp;carbon&nbsp;(entity_pk,&nbsp;entity_fk)&nbsp;VALUE&nbsp;(?,?)'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Bcrypt</span><span style="color: #007700">::</span><span style="color: #0000BB">genRandomHex</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">$dependant</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(\</span><span style="color: #0000BB">PDOException&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while&nbsp;(!</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'INSERT&nbsp;INTO&nbsp;carbon_tag&nbsp;(entity_id,&nbsp;user_id,&nbsp;tag_id,&nbsp;creation_date)&nbsp;VALUES&nbsp;(?,?,?,?)'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;(!empty(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">$tag_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">time</span><span style="color: #007700">()]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$entityTransactionKeys</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;If&nbsp;other&nbsp;entities&nbsp;reference&nbsp;the&nbsp;my&nbsp;be&nbsp;deleted&nbsp;baised&nbsp;on&nbsp;how&nbsp;they&nbsp;are&nbsp;set&nbsp;up&nbsp;on&nbsp;your&nbsp;database<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;https://dev.mysql.com/doc/refman/5.7/en/innodb-index-types.html<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$id&nbsp;-&nbsp;Remove&nbsp;entity_pk&nbsp;form&nbsp;carbon<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;bool<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">remove_entity</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;:&nbsp;</span><span style="color: #0000BB">bool<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'DELETE&nbsp;FROM&nbsp;carbon&nbsp;WHERE&nbsp;entity_pk&nbsp;=&nbsp;?'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #0000BB">$id</span><span style="color: #007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$sql</span><span style="color: #007700">,&nbsp;...</span><span style="color: #0000BB">$execute</span><span style="color: #007700">)&nbsp;:&nbsp;</span><span style="color: #0000BB">bool<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Use&nbsp;prepaired&nbsp;statements&nbsp;with&nbsp;question&nbsp;mark&nbsp;values.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;https://www.w3schools.com/php/php_mysql_prepared_statements.asp<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Pass&nbsp;parameters&nbsp;separated&nbsp;by&nbsp;commas&nbsp;in&nbsp;order&nbsp;denoted&nbsp;by&nbsp;the&nbsp;sql&nbsp;stmt<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Example:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;$array&nbsp;=&nbsp;static::fetch('SELECT&nbsp;*&nbsp;FROM&nbsp;user&nbsp;WHERE&nbsp;user_id&nbsp;=&nbsp;?',&nbsp;$id);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$sql<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;...$execute<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@link&nbsp;http://php.net/manual/en/functions.arguments.php<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$sql</span><span style="color: #007700">,&nbsp;...</span><span style="color: #0000BB">$execute</span><span style="color: #007700">):&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">)&nbsp;&amp;&amp;&nbsp;!</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">))&nbsp;{&nbsp;</span><span style="color: #FF8000">//&nbsp;try&nbsp;it&nbsp;twice,&nbsp;you&nbsp;never&nbsp;know..<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">())&nbsp;===&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">[</span><span style="color: #DD0000">'0'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">[</span><span style="color: #DD0000">'0'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">)&nbsp;:&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;promise&nbsp;this&nbsp;is&nbsp;needed&nbsp;and&nbsp;will&nbsp;still&nbsp;return&nbsp;the&nbsp;desired&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Quickly&nbsp;prepare&nbsp;and&nbsp;execute&nbsp;PDO&nbsp;$sql&nbsp;statements&nbsp;using<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;variable&nbsp;arguments.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Example:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;$array['following']&nbsp;=&nbsp;self::fetchColumn('SELECT&nbsp;follows_user_id&nbsp;FROM&nbsp;user_followers&nbsp;WHERE&nbsp;user_id&nbsp;=&nbsp;?',&nbsp;$id);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$sql&nbsp;-&nbsp;variables&nbsp;should&nbsp;be&nbsp;denoted&nbsp;by&nbsp;question&nbsp;marks<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;...$execute&nbsp;-<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;if&nbsp;multiple&nbsp;question&nbsp;marks&nbsp;exist&nbsp;you&nbsp;may&nbsp;use&nbsp;comma&nbsp;separated&nbsp;parameters&nbsp;to&nbsp;fill&nbsp;the&nbsp;statement<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fetchColumn</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$sql</span><span style="color: #007700">,&nbsp;...</span><span style="color: #0000BB">$execute</span><span style="color: #007700">):&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_COLUMN</span><span style="color: #007700">))&nbsp;===&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">[</span><span style="color: #DD0000">'0'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">[</span><span style="color: #DD0000">'0'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">)&nbsp;:&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;This&nbsp;returns&nbsp;all&nbsp;values&nbsp;from&nbsp;the&nbsp;requested&nbsp;query&nbsp;as&nbsp;an&nbsp;Object&nbsp;to&nbsp;type&nbsp;stdClass.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;Its&nbsp;important&nbsp;to&nbsp;note&nbsp;that&nbsp;PHP&nbsp;arrays&nbsp;are&nbsp;hash&nbsp;tables.&nbsp;This&nbsp;means&nbsp;that<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;while&nbsp;semantically&nbsp;pleasing,&nbsp;fetching&nbsp;into&nbsp;an&nbsp;object&nbsp;should&nbsp;be&nbsp;avoided<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$sql<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;...$execute<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;stdClass<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;\Exception<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fetch_object</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$sql</span><span style="color: #007700">,&nbsp;...</span><span style="color: #0000BB">$execute</span><span style="color: #007700">):&nbsp;</span><span style="color: #0000BB">stdClass<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setFetchMode</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_CLASS</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">stdClass</span><span style="color: #007700">::class);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">'Failed&nbsp;to&nbsp;Execute'</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;user&nbsp;obj<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;(\</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">)&nbsp;&amp;&amp;&nbsp;\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">)&nbsp;===&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;:&nbsp;new&nbsp;</span><span style="color: #0000BB">stdClass</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Each&nbsp;row&nbsp;received&nbsp;will&nbsp;be&nbsp;converted&nbsp;into&nbsp;its&nbsp;own&nbsp;object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$sql<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;...$execute<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;array&nbsp;of&nbsp;stdClass::class&nbsp;objects<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fetch_classes</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$sql</span><span style="color: #007700">,&nbsp;...</span><span style="color: #0000BB">$execute</span><span style="color: #007700">):&nbsp;array<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setFetchMode</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_CLASS</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">stdClass</span><span style="color: #007700">::class);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;user&nbsp;obj<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Fetch&nbsp;a&nbsp;sql&nbsp;query&nbsp;and&nbsp;return&nbsp;results&nbsp;directly&nbsp;into&nbsp;the&nbsp;global&nbsp;scope<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;$sql<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$execute<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fetch_to_global</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$sql</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$execute</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setFetchMode</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">FETCH_CLASS</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Globals</span><span style="color: #007700">::class);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;user&nbsp;obj<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**&nbsp;Run&nbsp;an&nbsp;sql&nbsp;statement&nbsp;and&nbsp;return&nbsp;results&nbsp;as&nbsp;attributes&nbsp;of&nbsp;a&nbsp;stdClass<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$object<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;$sql<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;array&nbsp;...$execute<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">protected&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">fetch_into_class</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$object</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,&nbsp;...</span><span style="color: #0000BB">$execute</span><span style="color: #007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Database</span><span style="color: #007700">::</span><span style="color: #0000BB">database</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$execute</span><span style="color: #007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$object</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>}</span>

</span></code></pre>
        </div>
    </div>

